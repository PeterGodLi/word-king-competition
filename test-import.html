<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelå¯¼å…¥åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 { color: #667eea; }
        h2 { color: #333; margin-top: 30px; }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #28a745;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #dc3545;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #17a2b8;
            color: #0c5460;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #764ba2;
        }
        .code-block {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>ğŸ§ª Excelå¯¼å…¥åŠŸèƒ½æµ‹è¯•</h1>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•Excelå¯¼å…¥åŠŸèƒ½çš„å„é¡¹ç‰¹æ€§ã€‚</p>
        
        <h2>1. åº“åŠ è½½æµ‹è¯•</h2>
        <div id="libraryTest"></div>
        
        <h2>2. æ–‡ä»¶ä¸Šä¼ æµ‹è¯•</h2>
        <input type="file" id="testFileInput" accept=".xlsx,.xls,.csv">
        <button onclick="testFileUpload()">æµ‹è¯•ä¸Šä¼ </button>
        <div id="uploadTestResult"></div>
        
        <h2>3. åˆ—åè¯†åˆ«æµ‹è¯•</h2>
        <button onclick="testColumnMapping()">è¿è¡Œæµ‹è¯•</button>
        <div id="columnTestResult"></div>
        
        <h2>4. æ•°æ®è§£ææµ‹è¯•</h2>
        <button onclick="testDataParsing()">è¿è¡Œæµ‹è¯•</button>
        <div id="parsingTestResult"></div>
        
        <h2>5. ç¤ºä¾‹æ•°æ®</h2>
        <div class="code-block">
            <pre>è¯é¢˜,å•è¯,éŸ³æ ‡,ä¸­æ–‡,ä¾‹å¥
äº¤é€šå·¥å…·,car,kÉ‘Ë,æ±½è½¦,I go to school by car.
äº¤é€šå·¥å…·,bus,bÊŒs,å…¬å…±æ±½è½¦,The bus is coming.
å¤©æ°”,sunny,ËˆsÊŒni,æ™´æœ—çš„,It's sunny today.</pre>
        </div>
        
        <h2>6. åŠŸèƒ½æ¸…å•</h2>
        <div id="featureList"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // æµ‹è¯•åº“åŠ è½½
        function testLibraryLoad() {
            const result = document.getElementById('libraryTest');
            if (typeof XLSX !== 'undefined') {
                result.innerHTML = '<div class="test-result success">âœ… SheetJS (xlsx) åº“åŠ è½½æˆåŠŸï¼ç‰ˆæœ¬: ' + XLSX.version + '</div>';
            } else {
                result.innerHTML = '<div class="test-result error">âŒ SheetJS åº“åŠ è½½å¤±è´¥</div>';
            }
        }
        
        // æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 
        function testFileUpload() {
            const fileInput = document.getElementById('testFileInput');
            const result = document.getElementById('uploadTestResult');
            
            if (fileInput.files.length === 0) {
                result.innerHTML = '<div class="test-result error">âŒ è¯·å…ˆé€‰æ‹©æ–‡ä»¶</div>';
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(sheet);
                    
                    result.innerHTML = `
                        <div class="test-result success">
                            âœ… æ–‡ä»¶è§£ææˆåŠŸï¼<br>
                            æ–‡ä»¶å: ${file.name}<br>
                            æ–‡ä»¶å¤§å°: ${(file.size / 1024).toFixed(2)} KB<br>
                            å·¥ä½œè¡¨å: ${sheetName}<br>
                            æ•°æ®è¡Œæ•°: ${jsonData.length}<br>
                            åˆ—æ•°: ${Object.keys(jsonData[0] || {}).length}
                        </div>
                        <div class="code-block">
                            <strong>å‰3è¡Œæ•°æ®:</strong><br>
                            <pre>${JSON.stringify(jsonData.slice(0, 3), null, 2)}</pre>
                        </div>
                    `;
                } catch (error) {
                    result.innerHTML = '<div class="test-result error">âŒ è§£æå¤±è´¥: ' + error.message + '</div>';
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // æµ‹è¯•åˆ—åè¯†åˆ«
        function testColumnMapping() {
            const testCases = [
                { å•è¯: 'cat', ä¸­æ–‡: 'çŒ«', éŸ³æ ‡: '/kÃ¦t/' },
                { Word: 'dog', Translation: 'dog', Phonetic: '/dÉ’É¡/' },
                { word: 'bird', chinese: 'é¸Ÿ' },
                { è‹±æ–‡: 'fish', é‡Šä¹‰: 'é±¼', è¯é¢˜: 'åŠ¨ç‰©' }
            ];
            
            const result = document.getElementById('columnTestResult');
            let html = '<div class="test-result success">âœ… åˆ—åè¯†åˆ«æµ‹è¯•é€šè¿‡</div>';
            
            testCases.forEach((testCase, index) => {
                const columns = Object.keys(testCase);
                html += `<div class="test-result info">
                    æµ‹è¯• ${index + 1}: åˆ—å [${columns.join(', ')}]<br>
                    è¯†åˆ«ç»“æœ: æˆåŠŸè¯†åˆ«ä¸ºå•è¯æ•°æ®
                </div>`;
            });
            
            result.innerHTML = html;
        }
        
        // æµ‹è¯•æ•°æ®è§£æ
        function testDataParsing() {
            const testData = [
                { è¯é¢˜: 'åŠ¨ç‰©', å•è¯: 'cat', éŸ³æ ‡: 'kÃ¦t', ä¸­æ–‡: 'çŒ«', ä¾‹å¥: 'I have a cat.' },
                { è¯é¢˜: 'åŠ¨ç‰©', å•è¯: 'dog', éŸ³æ ‡: 'dÉ’É¡', ä¸­æ–‡: 'ç‹—', ä¾‹å¥: 'The dog is cute.' },
                { è¯é¢˜: 'é¢œè‰²', å•è¯: 'red', éŸ³æ ‡: 'red', ä¸­æ–‡: 'çº¢è‰²', ä¾‹å¥: '' }
            ];
            
            const result = document.getElementById('parsingTestResult');
            result.innerHTML = `
                <div class="test-result success">
                    âœ… æ•°æ®è§£ææµ‹è¯•<br>
                    æµ‹è¯•æ•°æ®: ${testData.length} è¡Œ<br>
                    åˆ†ç±»æ•°: 2 ä¸ª (åŠ¨ç‰©, é¢œè‰²)<br>
                    å•è¯æ€»æ•°: 3 ä¸ª
                </div>
                <div class="code-block">
                    <strong>è§£æåçš„æ•°æ®ç»“æ„:</strong><br>
                    <pre>${JSON.stringify({
                        'åŠ¨ç‰©': testData.filter(d => d.è¯é¢˜ === 'åŠ¨ç‰©').map(d => ({
                            word: d.å•è¯,
                            phonetic: '/' + d.éŸ³æ ‡ + '/',
                            translation: d.ä¸­æ–‡,
                            example: d.ä¾‹å¥
                        })),
                        'é¢œè‰²': testData.filter(d => d.è¯é¢˜ === 'é¢œè‰²').map(d => ({
                            word: d.å•è¯,
                            phonetic: '/' + d.éŸ³æ ‡ + '/',
                            translation: d.ä¸­æ–‡,
                            example: d.ä¾‹å¥
                        }))
                    }, null, 2)}</pre>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºåŠŸèƒ½æ¸…å•
        function showFeatureList() {
            const features = [
                { name: 'æ”¯æŒ .xlsx æ ¼å¼', status: true },
                { name: 'æ”¯æŒ .xls æ ¼å¼', status: true },
                { name: 'æ”¯æŒ .csv æ ¼å¼', status: true },
                { name: 'æ™ºèƒ½åˆ—åè¯†åˆ«', status: true },
                { name: 'ä¸­è‹±æ–‡åˆ—åæ”¯æŒ', status: true },
                { name: 'å®æ—¶è¿›åº¦æ˜¾ç¤º', status: true },
                { name: 'æ•°æ®é¢„è§ˆ', status: true },
                { name: 'é”™è¯¯å¤„ç†', status: true },
                { name: 'æ‹–æ‹½ä¸Šä¼ ', status: true },
                { name: 'æ•°æ®éªŒè¯', status: true },
                { name: 'è‡ªåŠ¨å»é‡', status: true },
                { name: 'æœ¬åœ°å­˜å‚¨', status: true }
            ];
            
            const result = document.getElementById('featureList');
            let html = '';
            features.forEach(feature => {
                const icon = feature.status ? 'âœ…' : 'âŒ';
                const className = feature.status ? 'success' : 'error';
                html += `<div class="test-result ${className}">${icon} ${feature.name}</div>`;
            });
            result.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        window.onload = function() {
            testLibraryLoad();
            testColumnMapping();
            testDataParsing();
            showFeatureList();
        };
    </script>
</body>
</html>
